<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FM 2.0 Issue & Status Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .issue-card:hover { transform: translateY(-3px); transition: all 0.2s; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .tab-active { border-bottom: 3px solid white; font-weight: bold; opacity: 1 !important; }
        .category-pill.active { background-color: #1e3a8a; color: white; border-color: #1e3a8a; }
        .priority-high { border-left: 8px solid #ef4444 !important; background-color: #fef2f2; }
        .pulse-red { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        
        /* Category Styles */
        .cat-home { border-top: 6px solid #3b82f6; } 
        .cat-mobile { border-top: 6px solid #64748b; } 
        .cat-forms { border-top: 6px solid #f59e0b; } 
        .cat-money { border-top: 6px solid #10b981; } 
        .cat-ops { border-top: 6px solid #8b5cf6; } 
        .cat-tech { border-top: 6px solid #ef4444; }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900">

    <!-- FIXED HEADER -->
    <nav class="bg-blue-900 text-white shadow-xl sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="bg-white p-1 rounded flex-shrink-0">
                    <span class="text-blue-900 font-black text-lg px-1">i9</span>
                </div>
                <!-- Responsive text size prevents overlapping -->
                <h1 class="text-xs md:text-xl font-bold uppercase tracking-widest leading-tight">
                    FM 2.0 Issue Tracker
                </h1>
            </div>
            <div class="flex space-x-2 md:space-x-4 flex-shrink-0">
                <button onclick="switchView('report')" id="nav-report" class="tab-active opacity-80 hover:opacity-100 py-1 uppercase text-[10px] md:text-xs tracking-widest px-2">Report</button>
                <button onclick="switchView('status')" id="nav-status" class="opacity-80 hover:opacity-100 py-1 uppercase text-[10px] md:text-xs tracking-widest px-2">Status</button>
            </div>
        </div>
    </nav>

    <!-- EXECUTIVE SUMMARY -->
    <div class="bg-white border-b border-slate-200 p-3 shadow-sm">
        <div class="container mx-auto grid grid-cols-2 md:grid-cols-4 gap-2 text-center">
            <div><p class="text-[9px] text-slate-500 uppercase font-bold">Total Logs</p><p id="stat-total" class="text-lg font-black">0</p></div>
            <div><p class="text-[9px] text-red-600 uppercase font-bold">High Priority</p><p id="stat-high" class="text-lg font-black text-red-600">0</p></div>
            <div><p class="text-[9px] text-blue-600 uppercase font-bold">Active</p><p id="stat-pending" class="text-lg font-black text-blue-600">0</p></div>
            <button onclick="exportToCSV()" class="bg-slate-800 text-white text-[9px] font-bold uppercase py-1 px-3 rounded self-center hover:bg-black">Export CSV</button>
        </div>
    </div>

    <main class="container mx-auto p-4">
        
        <div id="view-report">
            <!-- Search & Smart Tabs -->
            <div class="bg-white p-4 rounded-xl shadow-md mb-6">
                <input type="text" id="searchInput" onkeyup="renderIssues()" placeholder="Search problem (e.g. 'refund', 'login', 'email')..." 
                       class="w-full p-3 border-2 border-slate-200 rounded-lg focus:border-blue-500 outline-none text-md mb-4 shadow-inner">
                
                <div id="smartTabs" class="flex flex-wrap gap-2">
                    <!-- Tabs generated by JS -->
                </div>
            </div>

            <!-- Custom Entry -->
            <div class="mb-8 p-4 bg-blue-50 border-2 border-dashed border-blue-200 rounded-xl text-center">
                <button onclick="showCustomForm()" class="bg-blue-900 text-white px-4 py-2 rounded-lg font-bold text-xs uppercase">Add Custom Issue +</button>
                <div id="customForm" class="hidden mt-4 text-left max-w-md mx-auto bg-white p-4 rounded-lg shadow-lg">
                    <h4 class="font-bold text-sm text-blue-900 mb-2">New Issue Details</h4>
                    <input type="text" id="customSymptom" placeholder="Issue Name (e.g. Printer Won't Connect)" class="w-full p-2 border mb-2 rounded text-xs">
                    <textarea id="customFlaw" placeholder="Describe what happened..." class="w-full p-2 border mb-2 rounded text-xs h-16"></textarea>
                    <div class="flex justify-end space-x-2">
                        <button onclick="showCustomForm()" class="text-[10px] text-slate-500">Cancel</button>
                        <button onclick="submitCustomIssue()" class="bg-emerald-600 text-white px-3 py-1 rounded text-[10px] font-bold">Save</button>
                    </div>
                </div>
            </div>

            <div id="issueGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- 50 Real Issues Injected Here -->
            </div>
        </div>

        <!-- STATUS VIEW -->
        <div id="view-status" class="hidden">
            <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                <table class="w-full text-left text-xs">
                    <thead class="bg-slate-800 text-white uppercase">
                        <tr>
                            <th class="p-3">Priority</th>
                            <th class="p-3">Age</th>
                            <th class="p-3">Issue</th>
                            <th class="p-3">AD/Location</th>
                            <th class="p-3">Status</th>
                        </tr>
                    </thead>
                    <tbody id="statusTableBody" class="divide-y divide-slate-200"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // 50 REAL-WORLD ISSUES (ASP.NET / FM 2.0 LEGACY)
        const commonIssues = [
            // TECH / SECURITY
            { id: 1, cat: "Tech", s: "Password Reset Loop", f: "Reset email never arrives or link redirects to login.", p: "High" },
            { id: 2, cat: "Tech", s: "Yellow Screen of Death", f: "Site crashes showing code errors on a yellow background.", p: "High" },
            { id: 3, cat: "Tech", s: "Not Secure Warning", f: "Browser address bar says 'Not Secure' (HTTP vs HTTPS).", p: "High" },
            { id: 4, cat: "Tech", s: "Login Token Loop", f: "Forced to log in repeatedly after entering credentials.", p: "High" },
            { id: 5, cat: "Tech", s: "Object Reference Error", f: "System error: 'Object reference not set to an instance'.", p: "Med" },
            
            // MONEY / FINANCIALS
            { id: 6, cat: "Money", s: "Double Charge", f: "Parent clicked 'Pay' twice; system charged twice.", p: "High" },
            { id: 7, cat: "Money", s: "Refund Button Fail", f: "Refund process fails or times out.", p: "High" },
            { id: 8, cat: "Money", s: "Sibling Discount Missing", f: "Cart total did not apply discount for second child.", p: "High" },
            { id: 9, cat: "Money", s: "Payment Session Timeout", f: "System crashed while typing credit card info.", p: "High" },
            { id: 10, cat: "Money", s: "1-Cent Math Error", f: "Total price is off by exactly $0.01.", p: "Med" },
            { id: 11, cat: "Money", s: "Waitlist Bypass", f: "Parents signed up for full program via direct link.", p: "High" },
            { id: 12, cat: "Money", s: "Cart Emptied Randomly", f: "Items disappeared from cart before checkout.", p: "High" },
            { id: 13, cat: "Money", s: "Promo Code Invalid", f: "Valid code rejected by system.", p: "Med" },
            
            // MOBILE / TOUCH
            { id: 14, cat: "Mobile", s: "Side-Scroll Struggle", f: "Table too wide for phone; requires horizontal scrolling.", p: "Med" },
            { id: 15, cat: "Mobile", s: "Buttons Too Small", f: "Hard to tap 'Save' or 'Edit' without zooming in.", p: "Med" },
            { id: 16, cat: "Mobile", s: "Keyboard Covers Input", f: "Phone keyboard hides the box you are typing in.", p: "Med" },
            { id: 17, cat: "Mobile", s: "Menu Won't Open", f: "Hamburger menu button unresponsive on touchscreen.", p: "High" },
            { id: 18, cat: "Mobile", s: "Pinch-to-Zoom Fatigue", f: "Text too small; requires manual zooming to read.", p: "Med" },

            // OPS / REPORTS
            { id: 19, cat: "Ops", s: "Email Code Mess", f: "Emails sent to parents contain broken HTML code.", p: "High" },
            { id: 20, cat: "Ops", s: "Weather Alert Delay", f: "SMS alerts take 20+ mins to reach parents.", p: "High" },
            { id: 21, cat: "Ops", s: "Roster Builder Crash", f: "System freezes when assigning players to teams.", p: "High" },
            { id: 22, cat: "Ops", s: "Jersey Report Desync", f: "Report says 'Ordered', but Dashboard says 'Missing'.", p: "Med" },
            { id: 23, cat: "Ops", s: "Export to Excel Timeout", f: "Downloading large reports crashes the browser.", p: "Med" },
            { id: 24, cat: "Ops", s: "Label Print Misaligned", f: "Names don't line up with sticker paper.", p: "Med" },
            { id: 25, cat: "Ops", s: "Schedule Conflict Ignored", f: "System allowed two games on same field at same time.", p: "High" },
            { id: 26, cat: "Ops", s: "Standings Calc Wrong", f: "Team wins/losses not calculating correctly.", p: "Med" },
            { id: 27, cat: "Ops", s: "Photo Upload Fail", f: "System rejects valid photo upload.", p: "Med" },
            { id: 28, cat: "Ops", s: "Background Check Stuck", f: "Coach status stuck on 'Pending' for weeks.", p: "High" },
            
            // FORMS / DATA
            { id: 29, cat: "Forms", s: "30-Min Auto Logout", f: "Kicked out of system while typing notes.", p: "High" },
            { id: 30, cat: "Forms", s: "Infinite Spinner", f: "Loading circle spins forever (UpdatePanel hang).", p: "High" },
            { id: 31, cat: "Forms", s: "Back-Button Crash", f: "Clicking browser 'Back' causes form error.", p: "Med" },
            { id: 32, cat: "Forms", s: "Ghost Data (Cache)", f: "Old data shows even after saving changes.", p: "Med" },
            { id: 33, cat: "Forms", s: "Search Space Error", f: "Search fails if name has a trailing space.", p: "Med" },
            { id: 34, cat: "Forms", s: "Required Field Missing", f: "Error says field missing, but no box to type in.", p: "High" },
            { id: 35, cat: "Forms", s: "Date Picker Glitch", f: "Calendar popup blocked by other page elements.", p: "Med" },
            { id: 36, cat: "Forms", s: "Dropdown Empty", f: "Select menu shows no options to pick from.", p: "High" },
            { id: 37, cat: "Forms", s: "Duplicate Profile", f: "System created two accounts for same child.", p: "Med" },
            { id: 38, cat: "Forms", s: "View State Error", f: "Form validation failed (ViewState Invalid).", p: "High" },
            
            // HOME / GENERAL
            { id: 39, cat: "Home", s: "Franchise Ghosting", f: "Seeing data for wrong franchise ID.", p: "High" },
            { id: 40, cat: "Home", s: "Broken Chart Image", f: "Dashboard graphs show as broken image icons.", p: "Med" },
            { id: 41, cat: "Home", s: "Stats Data Mismatch", f: "Current numbers don't match reports.", p: "Med" },
            { id: 42, cat: "Home", s: "Server Busy Error", f: "System overload message during peak hours.", p: "High" },
            { id: 43, cat: "Home", s: "Audit Log Empty", f: "Cannot see who made changes to a record.", p: "Med" },
            { id: 44, cat: "Home", s: "Browser Incompatible", f: "Site forces 'Compatibility Mode' or breaks.", p: "Med" },
            { id: 45, cat: "Home", s: "Cookie Popup Block", f: "Cannot close cookie/policy popup.", p: "Med" },
            { id: 46, cat: "Tech", s: "Late Fee Fail", f: "Late fees not applying automatically.", p: "Money" },
            { id: 47, cat: "Ops", s: "Coach App Lost", f: "Volunteer application disappeared.", p: "Med" },
            { id: 48, cat: "Mobile", s: "Map Embed Broken", f: "Field location map shows gray box.", p: "Med" },
            { id: 49, cat: "Money", s: "Tax Calc Error", f: "Sales tax applied incorrectly.", p: "High" },
            { id: 50, cat: "Forms", s: "Notes Field Cutoff", f: "Long notes get deleted/truncated.", p: "Med" }
        ];

        let logs = JSON.parse(localStorage.getItem('i9FM_v4')) || [];
        let currentCat = 'All';

        function init() {
            renderTabs();
            renderIssues();
            updateStats();
        }

        function renderTabs() {
            const cats = ['All', 'Home', 'Mobile', 'Forms', 'Money', 'Ops', 'Tech'];
            document.getElementById('smartTabs').innerHTML = cats.map(c => `
                <button onclick="setCat('${c}')" class="category-pill border px-3 py-1 rounded-full text-[10px] font-bold transition-all ${currentCat === c ? 'active' : 'bg-white text-slate-500'}">
                    ${c}
                </button>
            `).join('');
        }

        function renderIssues() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const grid = document.getElementById('issueGrid');
            const filtered = commonIssues.filter(i => {
                const matchSearch = i.s.toLowerCase().includes(search) || i.f.toLowerCase().includes(search);
                const matchCat = currentCat === 'All' || i.cat === currentCat;
                return matchSearch && matchCat;
            });

            grid.innerHTML = filtered.map(i => `
                <div class="issue-card bg-white p-4 rounded-xl border-t-4 shadow-sm ${i.p === 'High' ? 'priority-high' : ''} cat-${i.cat.toLowerCase()}">
                    <div class="flex justify-between text-[9px] font-bold uppercase mb-1">
                        <span class="text-slate-400">${i.cat}</span>
                        ${i.p === 'High' ? '<span class="text-red-600 pulse-red">‚óè High Priority</span>' : ''}
                    </div>
                    <h3 class="font-black text-slate-800 leading-tight mb-1 text-sm">${i.s}</h3>
                    <p class="text-[11px] text-slate-500 mb-3">"${i.f}"</p>
                    
                    <div class="space-y-2 border-t pt-3">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" id="ad-${i.id}" placeholder="AD Name" class="p-2 text-[10px] border rounded bg-slate-50 outline-none">
                            <input type="text" id="loc-${i.id}" placeholder="Location" class="p-2 text-[10px] border rounded bg-slate-50 outline-none">
                        </div>
                        <button onclick="logIncident(${i.id})" class="w-full bg-blue-900 text-white py-2 rounded font-bold text-[10px] uppercase tracking-wider hover:bg-black transition-colors">Log Issue</button>
                    </div>
                </div>
            `).join('');
        }

        function logIncident(id) {
            const issue = commonIssues.find(x => x.id === id);
            const ad = document.getElementById(`ad-${id}`).value;
            const loc = document.getElementById(`loc-${id}`).value;
            if(!ad) { alert("Please enter AD Name"); return; }
            
            logs.unshift({
                id: Date.now(),
                s: issue.s,
                ad: ad,
                loc: loc,
                p: issue.p,
                date: new Date(),
                status: 'Sent to Office',
                res: false
            });
            save();
            alert("Issue saved to tracker!");
        }

        function submitCustomIssue() {
            const s = document.getElementById('customSymptom').value;
            const f = document.getElementById('customFlaw').value;
            if(!s) return;
            // Add custom issue to top of common list temporarily
            const newId = Date.now();
            commonIssues.unshift({ id: newId, cat: "Tech", s: s, f: f, p: "Med" });
            showCustomForm();
            renderIssues();
            
            // Auto-log it as well? User flow implies adding it to list first, then logging.
            // But let's clear the form.
            document.getElementById('customSymptom').value = '';
            document.getElementById('customFlaw').value = '';
        }

        function showCustomForm() { document.getElementById('customForm').classList.toggle('hidden'); }
        function setCat(c) { currentCat = c; renderTabs(); renderIssues(); }
        function save() { localStorage.setItem('i9FM_v4', JSON.stringify(logs)); updateStats(); }

        function switchView(v) {
            document.getElementById('view-report').classList.toggle('hidden', v !== 'report');
            document.getElementById('view-status').classList.toggle('hidden', v !== 'status');
            document.getElementById('nav-report').classList.toggle('tab-active', v === 'report');
            document.getElementById('nav-status').classList.toggle('tab-active', v === 'status');
            if(v === 'status') renderStatusTable();
        }

        function renderStatusTable() {
            const body = document.getElementById('statusTableBody');
            body.innerHTML = logs.map(l => {
                const age = Math.floor((new Date() - new Date(l.date)) / (1000 * 60 * 60 * 24));
                return `
                    <tr class="${l.res ? 'opacity-40 bg-slate-50' : ''}">
                        <td class="p-3 font-bold ${l.p === 'High' ? 'text-red-600' : 'text-slate-400'}">${l.p}</td>
                        <td class="p-3">${age}d</td>
                        <td class="p-3 font-bold">${l.s}</td>
                        <td class="p-3">${l.ad}<br><span class="text-[9px] text-slate-400">${l.loc}</span></td>
                        <td class="p-3">
                            <select onchange="updateStatus(${l.id}, this.value)" class="text-[9px] border p-1 rounded">
                                <option ${l.status === 'Sent to Office' ? 'selected' : ''}>Sent to Office</option>
                                <option ${l.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                            </select>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateStatus(id, val) {
            const log = logs.find(x => x.id === id);
            log.status = val;
            log.res = (val === 'Resolved');
            save();
            renderStatusTable();
        }

        function updateStats() {
            document.getElementById('stat-total').innerText = logs.length;
            document.getElementById('stat-high').innerText = logs.filter(x => x.p === 'High' && !x.res).length;
            document.getElementById('stat-pending').innerText = logs.filter(x => !x.res).length;
        }

        function exportToCSV() {
            if(logs.length === 0) { alert("No logs to export."); return; }
            let csv = "Priority,Age(Days),Issue,AD,Location,Status\n";
            logs.forEach(l => csv += `"${l.p}","${Math.floor((new Date() - new Date(l.date))/(1000*60*60*24))}","${l.s}","${l.ad}","${l.loc}","${l.status}"\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'FM_Status_Report.csv'; a.click();
        }

        init();
    </script>
</body>
</html>
